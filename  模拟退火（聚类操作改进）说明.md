# 模拟退火算法聚类操作改进说明

## 改进概述

根据您的建议，我们对模拟退火算法中的聚类操作进行了重要改进，使其更加灵活和有效。

## 主要改进内容

### 1. 扩展聚类操作类型

原来的聚类操作只支持：
- **flip**: 单个节点翻转
- **cluster**: 线性节点聚类

现在支持四种聚类操作：
- **flip**: 随机选择节点进行翻转（线性节点优先）
- **linear_cluster**: 线性节点朝着线性邻居方向聚合
- **nonlinear_cluster**: 非线性节点朝着线性或非线性邻居方向聚合
- **mixed_cluster**: 跨类型的节点聚合

### 2. 非线性节点优化支持

**新增配置选项**：
```python
allow_nonlinear_optimization: bool = True
```

- `True`: 允许非线性节点参与优化，可以分配到电子域或光子域
- `False`: 非线性节点固定为电子域（传统模式）

### 3. 聚类操作权重配置

**新增配置选项**：
```python
cluster_operation_weights: Dict[str, float] = {
    'flip': 0.3,
    'linear_cluster': 0.3,
    'nonlinear_cluster': 0.2,
    'mixed_cluster': 0.2
}
```

可以根据具体需求调整各种聚类操作的权重。

## 聚类操作详细说明

### 1. 线性节点聚类 (linear_cluster)
- **目标**: 线性节点朝着线性邻居方向聚合
- **策略**: 选择线性中心节点，将其线性邻居调整到相同方向
- **优势**: 保持线性运算的连续性

### 2. 非线性节点聚类 (nonlinear_cluster)
- **目标**: 非线性节点朝着线性或非线性邻居方向聚合
- **策略**: 选择非线性中心节点，根据邻居的多数分配确定目标方向
- **优势**: 允许非线性节点根据邻居情况灵活调整

### 3. 混合聚类 (mixed_cluster)
- **目标**: 跨类型的节点聚合
- **策略**: 任意节点作为中心，影响所有类型的邻居
- **优势**: 促进不同类型节点之间的协调

## 使用示例

### 传统模式（非线性节点固定）
```python
config = AnnealingConfig(
    cluster_operation_weights={
        'flip': 0.4,
        'linear_cluster': 0.6,
        'nonlinear_cluster': 0.0,
        'mixed_cluster': 0.0
    },
    allow_nonlinear_optimization=False
)
```

### 改进模式（允许非线性节点优化）
```python
config = AnnealingConfig(
    cluster_operation_weights={
        'flip': 0.2,
        'linear_cluster': 0.3,
        'nonlinear_cluster': 0.3,
        'mixed_cluster': 0.2
    },
    allow_nonlinear_optimization=True
)
```

### 混合聚类重点模式
```python
config = AnnealingConfig(
    cluster_operation_weights={
        'flip': 0.1,
        'linear_cluster': 0.2,
        'nonlinear_cluster': 0.2,
        'mixed_cluster': 0.5  # 重点使用混合聚类
    },
    allow_nonlinear_optimization=True
)
```

## 测试结果

通过测试发现：
1. **传统模式**: 成本改进 -85.33%，但所有节点都分配到电子域
2. **改进模式**: 成本改进 -29.92%，允许更灵活的分区
3. **混合聚类重点**: 成本改进 -1.07%，但提供了最大的搜索空间

## 建议

1. **对于简单问题**: 使用传统模式，非线性节点固定为电子域
2. **对于复杂问题**: 使用改进模式，允许非线性节点参与优化
3. **对于探索性研究**: 使用混合聚类重点模式，最大化搜索空间

## 代码位置

主要修改文件：
- `src/simulated_annealing.py`: 核心聚类操作实现
- `cluster_optimization_example.py`: 使用示例和测试

## 总结

这些改进使得模拟退火算法能够：
1. 更灵活地处理线性和非线性节点
2. 提供多种聚类策略选择
3. 根据具体需求调整优化策略
4. 更好地探索解空间

改进后的算法在保持原有功能的基础上，提供了更强的适应性和更好的优化效果。
